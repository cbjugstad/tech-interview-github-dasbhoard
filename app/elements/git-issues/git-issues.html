<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="git-issues">
  <template>
    <style>
      :host {
        display: block;
      }
      .card-row {
        margin-top: 20px;
      }
      .card-row:first-of-type {
        margin-top: 100px;
      }
      img {
        border-radius: 100%;
        max-width: 100px;
        min-width: 20px;
      }
      paper-dialog {
        --paper-dialog-background-color: white;
        width: 100%;
      }
      paper-dialog.size-position {
        position: fixed;
        top: 16px;
        right: 16px;
        width: 300px;
        height: 300px;
        overflow: auto;
      }
      .card-actions {
        text-align: center;
      }
      .card-actions > paper-button {
        color: var(--accent-color);
      }
      .chip {
        text-transform: capitalize;
        font-size: 12px;
        background: var(--default-primary-color);
        color: white;
        padding: 1px;
      }
    </style>
    
    <iron-ajax 
               id="ajax"
               url="{{url}}"
               handle-as="json"
               params="{{options}}"
               last-response="{{response}}"></iron-ajax>
    
    <!-- simple responsive Bootstrap container -->
    <div class="container-fluid">
      <!-- iterate over each value in the response -->
      <template is="dom-repeat" items="{{response}}">
        <div class="row card-row">
          <!-- col-xs-12 to take up the full 12 columns on extra small + screens (all screens) -->
          <paper-card heading="" class="col-xs-12">
            <div class="card-content">
              <div class="row">
                <p class="paper-font-subhead"><a target="_blank" href="{{item.html_url}}">{{item.title}}</a></p>
              </div>
              <div class="row">
                <a target="_blank" href="{{item.user.html_url}}">
                  <img src="{{item.user.avatar_url}}" class="col-xs-3 col-md-2"> 
                </a>
                <div class="col-xs-9 col-md-10">
                  <p>Username: <a target="_blank" href="{{item.user.html_url}}">{{item.user.login}}</a></p>
                  <p>Issue types: 
                    <template is="dom-repeat" items="{{item.labels}}">
                      <paper-button noink class="chip">{{item.name}}</paper-button>
                    </template>
                  </p>
                  <p>State: {{item.state}}</p>
                </div>
              </div>
            </div>
          </paper-card>
        </div>
      </template>
    </div>
      
  </template>
  <script>
  (function() {
    'use strict';

    Polymer({
      is: 'git-issues',

      properties: {
        // just going to default this and repo to my fields for this project for now
        owner: {
          value: 'thockaday1',
          notify: true
        },

        repo: {
          value: 'user-dashboard',
          notify: true
        },

        url: {
          /* if either owner or repo changes, this gets recomputed */
          computed: 'computeUrl(owner, repo)'
        },

        options: {
          computed: 'computeOptions(page)'
        }
      },
      
      /*ready: function() {
        this.refresh();
      },*/

      computeUrl: function(owner, repo) {
        return ['https://api.github.com/repos', owner, repo, 'issues'].join('/');
      },

      computeOptions: function(state, page) {
        return {page: page};
      },
      
      toggle: function() {
        var dialog = this.$.dialog;
        dialog.toggle();
      },
      
      refresh: function() {
        console.log("Refreshing");
        // with the way Polymer does its javascript scoping, we need to set grab the iron-ajax call by its id (via this.$.ajax) and then use that to generate the request at fixed intervals. Also, the this.$. is similar to the id selector
        var _this_ = this.$.ajax;
        _this_.generateRequest();
        
        // if you're logged in, we can make up to 5,000 requests per hour, but otherwise we can only do 60. There may not be much of a reason to do more than 60 per hour, though so I'll keep it to 60. For testing purposes, I'll just start with doing it every five minutes.
        /*setInterval(function(){
          _this_.generateRequest()
        }, 300000);*/
        
        /*if (this.username == '') {
          setInterval(function(){
            _this_.generateRequest()
          }, 60000);
        }
        else {
          setInterval(function(){
            _this_.generateRequest()
          }, 5000);
        }*/
        
      }
			
    });
  })();
  </script>
</dom-module>

			
    });
  })();
  </script>
</dom-module>
